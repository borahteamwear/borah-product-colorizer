var TB_ProductColorizer=function(t){var e={},r={elements:[]};r.get=function(e){return-1!==t.inArray(e,r.elements)?r.elements[e]:(r.elements[e]=jQuery(e),r.elements[e])},r.refresh=function(t){t.elements[t]=jQuery(t)};e.hex2rgb=function(t){var e="0123456789ABCDEF";return"rgba("+(16*e.indexOf(t[1])+e.indexOf(t[2]))+", "+(16*e.indexOf(t[3])+e.indexOf(t[4]))+", "+(16*e.indexOf(t[5])+e.indexOf(t[6]))+", 1)"};var a=function(){var a=r.get("#tb_svg_container"),n=r.get(".tb_wpc_place_svg_here > .tm-collapse > .tm-collapse-wrap");a.find("img.tb_wpc_svg_convert").each(function(){e.convertImageToSVG(t(this))}),n&&n.length>0&&a.detach().appendTo(n)};e.convertImageToSVG=function(t){var e,a=t.attr("id"),n=t.attr("class"),c=t.attr("src"),i=r.get("#tb_svg_container");jQuery.get(c,function(r){var c=jQuery(r).find("svg");void 0!==a&&(c=c.attr("id",a)),void 0!==n&&(c=c.attr("class",n+" replaced-svg")),c.attr("viewBox")||c.attr("viewBox","0 0 "+c.attr("width").match(/[0-9]+\.[0-9]*/)+" "+c.attr("height").match(/[0-9]+\.[0-9]*/)),c=c.removeAttr("xmlns:a"),t.replaceWith(c),e=c.outerHeight(),i.outerHeight()<e&&i.height(e)},"xml")};var n=function(){var t=r.get("#tb_svg_container");t.hide(),t.find(".tb_wpc_template_container").hide(),c(),i(),l()},c=function(){t(tb_wpc.templates.selector).on("change",function(){var e=t(this).val(),a=parseInt(tb_wpc.templates.values[e]),n=r.get("#tb_svg_container"),c=r.get("#template_"+a),i=c.find("svg").length-1;if(isNaN(a))return n.hide(),n.find(".tb_wpc_template_container").hide(),!1;n.is(":hidden")&&n.show(),n.find("> .tb_wpc_template_container").not(c).hide(),c.is(":hidden")&&(c.show(),setTimeout(function(){o(c)},50));for(var l=0;l<tb_wpc.colors.length;l++){var s=l+1,p=t(tb_wpc.colors[l].selector),u=p.parents(".tm-cell.cpf-type-color"),d=c.find("svg").eq(s);s>i?(u.hide(),d.find("path").css("fill","")):(u.show(),null!==p.val()&&p.val().length>0&&d.find("path").css("fill",p.spectrum("get").toRgbString()))}})},i=function(){function a(e){for(var r="#"+e.attr("id"),a=0;a<tb_wpc.colors.length;a++)if(t(tb_wpc.colors[a].selector).is(t(r)))return a;return 0}if(t.isArray(tb_wpc.colors)&&void 0!==tb_wpc.templates.selector&&t(tb_wpc.templates.selector)&&!(t(tb_wpc.templates.selector).length<1))for(var n={showPaletteOnly:!0,showPalette:!0,hideAfterPaletteSelect:!0,allowEmpty:!0,palette:[],change:function(t){t.toHexString()},show:function(e){if(void 0===tb_wpc.colorNames)return!0;t(".sp-container > .sp-palette-container > .sp-palette > .sp-palette-row > span.sp-thumb-el[title][data-color]").each(function(){var e=t(this),r=e.attr("title");tb_wpc.colorNames[r]&&e.attr("title",tb_wpc.colorNames[r])})}},c=0;c<tb_wpc.colors.length;c++){var i=t(tb_wpc.colors[c].selector);!i||i.length<1||(i.spectrum("destroy"),!function(t){return void 0!==tb_wpc.colors[c].defaultColor&&null!==tb_wpc.colors[c].defaultColor&&tb_wpc.colors[c].defaultColor.length>0}(tb_wpc.colors[c])?void 0!==n.color&&delete n.color:(i.val("#"+tb_wpc.colors[c].defaultColor),n.color="#"+tb_wpc.colors[c].defaultColor),n.palette=tb_wpc.colors[c].palette,n.change=function(n){var c=t(this),i=t(tb_wpc.templates.selector).val(),o=parseInt(tb_wpc.templates.values[i]),l=r.get("#template_"+o),s=a(c)+1,p=l.find("svg").eq(s),u=n.toHexString();p.find("path").css("fill",n.toRgbString()),0<u.length&&(u=u.replace("#","")),e.overridePrices(),c.val(tb_wpc.colorNames["#"+u])},i.spectrum(n))}},o=function(e){var r=0,a=e.find("> svg"),n=a.length,c=1;a.each(function(){var a=t(this).outerHeight();a>r&&(r=a),c>=n&&e.css("height",r+"px"),c++})},l=function(){if(!s())return console.log("not clickable templates"),!1;var e=t(tb_wpc.clickAbleTemplates.select),r=t(tb_wpc.clickAbleTemplates.products);if(!e||e.length<1||!r||r.length<1)return!1;r.on("click",function(r){r.preventDefault();var a=t(this).attr("data-value");void 0===a||a.length<1||e.val(a).change()})},s=function(){return void 0!==tb_wpc.clickAbleTemplates.select||void 0!==tb_wpc.clickAbleTemplates.products||tb_wpc.clickAbleTemplates.select.length<1||tb_wpc.clickAbleTemplates.products.length<1};e.getProductPrice=function(){var t=parseInt(r.get('form.cart .quantity > input[type="number"][name="quantity"].qty').val()),e=parseFloat(tb_wpc.productPrice),a=function(){for(var e=null,r=0;r<tb_wpc.discounts.length;r++)if(function(e){return t>=e.minQuantity&&(e.maxQuantity<=0||t<=e.maxQuantity)}(tb_wpc.discounts[r])){e=tb_wpc.discounts[r];break}return e}();return isNaN(e)&&(e=0),null!==a&&a.price>0?e=a.price:null!==a&&a.percentage>0&&(e-=e/100*a.percentage),e},e.calculateNewTotalPrice=function(a){"undefined"==typeof newTotalPrice&&(a=e.getProductPrice());var n=parseInt(r.get('form.cart .quantity > input[type="number"][name="quantity"].qty').val()),c=0;(isNaN(n)||0>=n)&&(n=1);for(var i=0;i<tb_wpc.colors.length;i++){var o=t(tb_wpc.colors[i].selector);if(o&&!(o.length<1)){var l=o.spectrum("get");if(l){var s=l.toHexString();if(s&&!(0>=s.length)){s=s.replace("#","");var p=parseFloat(tb_wpc.colorPrices[s]);if(!isNaN(p)){c=p;break}}}}}return c+=a,c+=e.additionalTMPrices(),c*=n,c+=e.getTMQuantityPrices(),c=c.toFixed(2)},e.additionalTMPrices=function(){var r=0;return t('input[type="radio"].tm-epo-field:checked').each(function(){var a=t(this),n=(a.attr("type"),e.getTMPrice(a.attr("data-original-rules")));r+=n}),r},e.getTMQuantityPrices=function(){var r=0;return t('input[type="number"].tm-epo-field').each(function(){var a=t(this),n=parseInt(a.val()),c=a.parents("ul[data-original-rules]");if(!(isNaN(n)||!c||c.length<1)){var i=e.getTMPrice(c.attr("data-original-rules"));i*=parseInt(a.val()),r+=i}}),r},e.getTMPrice=function(t){try{void 0!==(t=JSON.parse(t))[0]&&(t=parseFloat(t[0]),isNaN(t)&&(t=0))}catch(e){t=0}return t},e.overridePrices=function(){setTimeout(function(){var t=e.getProductPrice(),a=e.calculateNewTotalPrice(t);r.get("p.price span.amount").html('<span class="woocommerce-Price-currencySymbol">$</span>'+a),r.get("dd.tm-final-totals > span.price.amount.final").text("$"+a),r.get('input.tb_wpc_qty[type="number"]').each(function(){e.calculateNewTotalPrice(t)})},250)};var p=function(){t(".tb-pc-tm-disable-animation .tm-collapse > .tm-collapse-wrap").removeClass("tm-collapse-wrap"),t(tb_wpc.templates.selector).prepend('<option value="" selected="selected">Choose a Style</option>');var a=r.get('form.cart .quantity > input[type="number"][name="quantity"].qty'),n=t("input.tb_wpc_qty");a.val("0"),n.each(function(){var e=t(this);e.attr("type","number"),e.removeAttr("data-price data-rules data-original-rules data-rulestype data-freechars")}),n.off().on("input",function(){var r=0,c=n.length,i=1;n.each(function(){var n=t(this),o=parseInt(t(this).val());!isNaN(o)&&o>0?r+=o:n.val("0"),i>=c&&(a.val(r),e.overridePrices()),i++})}),a.off().on("input",function(){e.overridePrices()})},u=function(){function e(){var t=0;return r.each(function(){var e=parseInt(this.value);if(isNaN(e))return!0;t+=e}),t}var r=t("input.tb_wpc_qty"),a=t('button[type="submit"][name="add-to-cart"][value]');!r||r.length<1||!tb_wpc.isCustomTeamProduct||(e()<5&&(a.attr("disabled","disabled"),a.hide()),t('form[class="cart"]').on("submit",function(t){return total=e(),total>=5||(t.preventDefault(),!1)}),r.on("keyup keydown click",function(){e()>=5?(a.removeAttr("disabled"),a.show()):(a.attr("disabled","disabled"),a.hide())}))};return e.init=function(){n(),a(),p(),u()},e}(jQuery);jQuery(document).ready(function(){TB_ProductColorizer.init()});